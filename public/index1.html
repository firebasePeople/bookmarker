<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Booktracker</title>

</head>

<body>
    <h2>My booktracker</h2>
    <div id="readingDiv">
        <h4>Reading</h4>
        <input type="text" name="readingInput" id="readingInput" placeholder="add new book" />
        <input type="text" name="readingIsbn" id="readingIsbn" placeholder="add book's isbn" />
        <button id="readingBtn">Add</button>

        <ul id="readingUl">
            <li>reading</li>
        </ul>
    </div>
    <div id="toreadDiv">
        <h4>To read</h4>
        <input type="text" name="toreadInput" id="toreadInput" placeholder="add new book" />
        <input type="text" name="toreadIsbn" id="toreadIsbn" placeholder="add book's isbn" />
        <button id="toreadBtn">Add</button>
        <ul id="toreadUl">
            <li>To read</li>
        </ul>
    </div>
    <div id="readDiv">
        <h4>Done reading</h4>
        <input type="text" name="readInput" id="readInput" placeholder="add new book" />
        <input type="text" name="readIsbn" id="readIsbn" placeholder="add book's isbn" />
        <button id="readBtn">Add</button>
        <ul id="readUl">
            <li>Done Reading</li>
        </ul>
    </div>


    <!-- <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-app.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-auth.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-database.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-functions.js"></script> -->
    <script>
        var config = {
            apiKey: "AIzaSyC8fCrFKojwN3idl3rxDbdl87PzFYP7kNk",
            authDomain: "booktracker-9643e.firebaseapp.com",
            databaseURL: "https://booktracker-9643e.firebaseio.com",
            projectId: "booktracker-9643e",
            storageBucket: "booktracker-9643e.appspot.com",
            messagingSenderId: "801458307525"
        };
        firebase.initializeApp(config);
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function(e) {
            // e.preventDefault();

            var dbRef = firebase.database();


            function getDbData(collectionName) {
                var collRef = dbRef.ref().child(collectionName);
                // console.log(collRef.parent.name);
                collRef.on('value', function(snapshot) {
                    var bookList = snapshot.val();
                    console.log(bookList);
                    // console.log(bookList);
                    // console.log(snapshot.key);
                    // bookList.forEach();

                });
            };

            //this function searches for books with same isbn in the db in all the three columns. If there is any, it is removed from that column.
            // function removeInconsistency(bookId) {

            // }


            var readingBtn = document.querySelector('#readingBtn');
            var toreadBtn = document.querySelector('#toreadBtn');
            var readBtn = document.querySelector('#readBtn');

            readingBtn.addEventListener('click', function() {
                var readingField = document.querySelector('#readingInput').value;
                var readingIsbn = document.querySelector('#readingIsbn').value;
                dbRef.ref().child('reading').push({
                    name: readingField,
                    isbn: readingIsbn
                }).then(function() {
                    // console.log('success!book added successfully');
                    insertIntoList(readingField, readingIsbn, "readingUl");
                    inputClearFunction("readingInput");
                    inputClearFunction("readingIsbn");
                    getDbData('reading');

                }).catch(function(error) {
                    console.log(error);
                    window.alert('error adding book to the list');
                });
                console.log(readingField + ' ' + readingIsbn);
            });

            toreadBtn.addEventListener('click', function() {
                var toreadField = document.querySelector('#toreadInput').value;
                var toreadIsbn = document.querySelector('#toreadIsbn').value;
                dbRef.ref().child('toread').push({
                    bookname: toreadField,
                    isbn: toreadIsbn
                }).then(function() {
                    // console.log('success!book added successfully');
                    insertIntoList(toreadField, toreadIsbn, "toreadUl");
                    inputClearFunction("toreadInput");
                    inputClearFunction("toreadIsbn");
                    getDbData('toread');


                }).catch(function(error) {
                    window.alert('error adding book to the list');

                });
                console.log(toreadField + ' ' + toreadIsbn);
            });

            readBtn.addEventListener('click', function() {
                var readField = document.querySelector('#readInput').value;
                var readIsbn = document.querySelector('#readIsbn').value;
                dbRef.ref().child('read').push({
                    bookname: readField,
                    isbn: readIsbn
                }).then(function() {
                    // console.log('success!book added successfully');
                    insertIntoList(readField, readIsbn, "readUl");
                    inputClearFunction("readInput");
                    inputClearFunction("readIsbn");
                    getDbData('read');
                }).catch(function(error) {
                    window.alert('error adding book to the list');
                });
                console.log(readField);
            });

            function insertIntoList(bookName, bookIsbn, UlIdParam) {
                var liElement = document.createElement('li');
                var ulId = document.querySelector('#' + UlIdParam);
                liElement.innerText = bookName + ', isbn -' + bookIsbn;
                liElement.id = bookName;
                ulId.insertBefore(liElement, ulId.childNodes[0]);
            }

            function inputClearFunction(inputFieldId) {
                var tempreadIP = document.getElementById(inputFieldId);
                tempreadIP.value = '';
            }

            getDbData('reading');

        });
    </script>
</body>

</html>